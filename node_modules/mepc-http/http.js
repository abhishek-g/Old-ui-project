/**
 * Created by harinaths on 8/4/14.
 */

var express = require('express.io');
var http = require('http');
var path = require('path');
var socketio = require('socket.io');

var HttpServer = function(config){
    this.config = config;
    return this;
};

HttpServer.prototype.connect = function(){

    var app = this.app = express();
    var server = http.createServer(app);
    var io = socketio.listen(server);

    app.set('port', this.config.port || 8966);
    app.set('host', this.config.host || '0.0.0.0');
    app.set('views', path.join(this.config.root, 'views'));
    app.http().io();
    app.set('view engine', 'ejs');
    app.use(express.favicon());
    app.use(express.logger('dev'));
    app.use(express.json());
    app.use(express.urlencoded());
    app.use(express.methodOverride());
    app.use(express.cookieParser('mepc'));
    app.use(express.session());
    app.use(express.bodyParser());
    app.use(app.router);
    app.use(express.static(path.join(this.config.root, 'public')));

    // development only
    if ('development' == app.get('env')) {
        app.use(express.errorHandler());
    }

    server.listen(app.get('port'),app.get('host'), function(){
        console.log('Express server listening on port ' + app.get('port'));
    });


    app.set('socket', io );


    return app;
};



module.exports = HttpServer;
