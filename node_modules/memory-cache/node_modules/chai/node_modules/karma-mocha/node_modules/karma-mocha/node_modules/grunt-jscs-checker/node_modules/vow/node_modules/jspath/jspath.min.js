/**
* JSPath
*
* Copyright (c) 2012 Filatov Dmitry (dfilatov@yandex-team.ru)
* With parts by Marat Dulin (mdevils@gmail.com)
* Dual licensed under the MIT and GPL licenses:
* http://www.opensource.org/licenses/mit-license.php
* http://www.gnu.org/licenses/gpl.html
*
* @version 0.2.10
*/(function(){function r(e){return Function("data,subst",n(t(e)))}var e={PATH:1,SELECTOR:2,OBJ_PRED:3,POS_PRED:4,LOGICAL_EXPR:5,COMPARISON_EXPR:6,MATH_EXPR:7,CONCAT_EXPR:8,UNARY_EXPR:9,POS_EXPR:10,LITERAL:11,SUBST:12},t=function(){function u(e){r=e.split(""),i=0,s=null,o=r.length;var n=a(),u=O();return u.type!==t.EOP&&I(u),n}function a(){N()||I(O());var t=!1;T("^")&&(O(),t=!0);var n=[],r;while(r=f())n.push(r);return{type:e.PATH,fromRoot:t,parts:n}}function f(){if(C())return l();if(T("["))return c();if(T("{"))return h();if(T("("))return x()}function l(){var n=O().val,r=L(),i;if(T("*")||r.type===t.ID||r.type===t.STR)i=O().val;return{type:e.SELECTOR,selector:n,prop:i}}function c(){k("[");var t=b();return k("]"),{type:e.POS_PRED,arg:t}}function h(){k("{");var t=p();return k("}"),{type:e.OBJ_PRED,arg:t}}function p(){var t=d(),n;while(T("||"))O(),(n||(n=[t])).push(d());return n?{type:e.LOGICAL_EXPR,op:"||",args:n}:t}function d(){var t=v(),n;while(T("&&"))O(),(n||(n=[t])).push(v());return n?{type:e.LOGICAL_EXPR,op:"&&",args:n}:t}function v(){var t=m();while(T("==")||T("!=")||T("===")||T("!==")||T("^=")||T("^==")||T("$==")||T("$=")||T("*==")||T("*="))t={type:e.COMPARISON_EXPR,op:O().val,args:[t,v()]};return t}function m(){var t=g();while(T("<")||T(">")||T("<=")||T(">="))t={type:e.COMPARISON_EXPR,op:O().val,args:[t,m()]};return t}function g(){var t=y();while(T("+")||T("-"))t={type:e.MATH_EXPR,op:O().val,args:[t,g()]};return t}function y(){var t=w();while(T("*")||T("/")||T("%"))t={type:e.MATH_EXPR,op:O().val,args:[t,y()]};return t}function b(){if(T(":"))return O(),{type:e.POS_EXPR,toIdx:w()};var t=w();return T(":")?(O(),T("]")?{type:e.POS_EXPR,fromIdx:t}:{type:e.POS_EXPR,fromIdx:t,toIdx:w()}):{type:e.POS_EXPR,idx:t}}function w(){return T("!")||T("-")?{type:e.UNARY_EXPR,op:O().val,arg:w()}:E()}function E(){var n=L(),r=n.type;return r===t.STR||r===t.NUM||r===t.BOOL?{type:e.LITERAL,val:O().val}:r===t.ID&&n.val[0]==="$"?{type:e.SUBST,name:O().val.substr(1)}:N()?a():T("(")?S():I(O())}function S(){k("(");var e=p();return k(")"),e}function x(){k("(");var t=a(),n;while(T("|"))O(),(n||(n=[t])).push(a());return k(")"),n?{type:e.CONCAT_EXPR,op:"|",args:n}:t}function T(e){var n=L();return n.type===t.PUNCT&&n.val===e}function N(){return C()||T("^")}function C(){var e=L();if(e.type===t.PUNCT){var n=e.val;return n==="."||n===".."}return!1}function k(e){var n=O();(n.type!==t.PUNCT||n.val!==e)&&I(n)}function L(){if(s!==null)return s;var e=i;return s=A(),i=e,s}function A(){while(_(r[i]))++i;if(i>=o)return{type:t.EOP,range:[i,i]};var e=F();if(e||(e=H())||(e=B())||(e=j()))return e;I({val:r[i],range:[i,i]})}function O(){var e;return s?(i=s.range[1],e=s,s=null,e):A()}function M(e){return"0123456789".indexOf(e)>=0}function _(e){return e===" "}function D(e){return e==="$"||e==="_"||e>="a"&&e<="z"||e>="A"&&e<="Z"}function P(e){return D(e)||e>="0"&&e<="9"}function H(){var e=r[i];if(!D(e))return;var n=i,s=e;while(++i<o){e=r[i];if(!P(e))break;s+=e}return s==="true"||s==="false"?{type:t.BOOL,val:s==="true",range:[n,i]}:{type:t.ID,val:s,range:[n,i]}}function B(){if(r[i]!=='"')return;var e=++i,n="",s;while(i<o){s=r[i++];if(s==='"')break;n+=s}return{type:t.STR,val:n,range:[e,i]}}function j(){var e=i,n=r[i],s=n===".";if(s||M(n)){var u=n;while(++i<o){n=r[i];if(n==="."){if(s)return;s