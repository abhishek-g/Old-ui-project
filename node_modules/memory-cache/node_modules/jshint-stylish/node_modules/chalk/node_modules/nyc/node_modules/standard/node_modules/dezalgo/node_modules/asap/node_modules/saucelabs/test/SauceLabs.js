describe('SauceLabs', function () {
  var SauceLabs = require('..');
  var sauce;
  var nockle;

  describe('#constructor', function () {
    it('can be instantiated with `new`', function () {
      sauce = new SauceLabs();
      sauce.should.be.an.instanceof(SauceLabs);
    });
  });

  describe('once instantiated', function () {
    beforeEach(function () {
      var base = 'https://:username::password@saucelabs.com';
      var config = {
        username: 'johndoe',
        password: '550e8400-e29b-41d4-a716-446655440000'
      };

      sauce  = new SauceLabs(config);
      nockle = new chai.Nockle(base, config);
    });

    afterEach(function () {
      sauce  = null;
      nockle = null;
    });

    describe('when the response status is not 200', function () {
      it('notifies the callback', function (done) {
        var error = { error: 'foobar' };
        var mock = nockle.failget('/rest/v1/users/:username', null, error);
        sauce.getAccountDetails(verifyFailure(error, done));
      });
    });

    describe('when the response body cannot be parsed', function () {
      it('notifies the callback', function (done) {
        var error = 'foobar';
        var mock = nockle.failget('/rest/v1/users/:username', null, error);
        sauce.getAccountDetails(verifyFailure('Could not parse response: ' + error, done));
      });
    });

    describe('#getAccountDetails', function () {
      it('GETs `/rest/v1/users/:username`', function (done) {
        var mock = nockle.get('/rest/v1/users/:username');